<!doctype html>
<html>
<body>
<div id="status">评测中…</div>
<div id="score"></div>
<pre id="raw"></pre>

<script>
const params = new URLSearchParams(location.search);
const word = params.get("word");
const audioB64 = params.get("audio");

fetch(audioB64)
  .then(r => r.blob())
  .then(blob => {
    const fd = new FormData();
    fd.append("word", word);
    fd.append("audio", blob, "rec.webm");

    return fetch("/assess", { method: "POST", body: fd });
  })
  .then(r => r.json())
  .then(j => {
    document.getElementById("status").innerText = "完成";
    document.getElementById("score").innerText =
      "分数：" + j.score;
    document.getElementById("raw").innerText =
      JSON.stringify(j, null, 2);
  })
  .catch(e => {
    document.getElementById("status").innerText = "失败";
    console.error(e);
  });
</script>
</body>
</html>
